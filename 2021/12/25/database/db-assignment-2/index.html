

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="GONGGONGJOHN">
  <meta name="keywords" content="">
  
    <meta name="description" content="实验要求 功能 实现一个提供网上购书功能的网站后端。网站支持书商在上面开商店，购买者可能通过网站购买。买家和卖家都可以注册自己的账号。一个卖家可以开一个或多个网上商店，买家可以为自已 的账户充值，在任意商店购买图书。支持下单 \(\to\) 付款 \(\to\) 发货 \(\to\) 收货的流程。  实现对应接口的功能，见 doc 下面的.md 文件描述（60% 分数）  用户权限接口，如注册、登">
<meta property="og:type" content="article">
<meta property="og:title" content="当代数据管理系统项目二：书店（Bookstore）">
<meta property="og:url" content="http://gonggongjohn.me/2021/12/25/database/db-assignment-2/index.html">
<meta property="og:site_name" content="GONGGONGJOHN&#39;s Blog">
<meta property="og:description" content="实验要求 功能 实现一个提供网上购书功能的网站后端。网站支持书商在上面开商店，购买者可能通过网站购买。买家和卖家都可以注册自己的账号。一个卖家可以开一个或多个网上商店，买家可以为自已 的账户充值，在任意商店购买图书。支持下单 \(\to\) 付款 \(\to\) 发货 \(\to\) 收货的流程。  实现对应接口的功能，见 doc 下面的.md 文件描述（60% 分数）  用户权限接口，如注册、登">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://gonggongjohn.me/2021/12/25/database/db-assignment-2/system_arch.png">
<meta property="og:image" content="http://gonggongjohn.me/2021/12/25/database/db-assignment-2/db_ranking.png">
<meta property="og:image" content="http://gonggongjohn.me/2021/12/25/database/db-assignment-2/mysql_postgresql_compare.png">
<meta property="og:image" content="http://gonggongjohn.me/2021/12/25/database/db-assignment-2/backend_layer.png">
<meta property="og:image" content="http://gonggongjohn.me/2021/12/25/database/db-assignment-2/buyer_controller_uml.png">
<meta property="og:image" content="http://gonggongjohn.me/2021/12/25/database/db-assignment-2/db_concur_test2.png">
<meta property="og:image" content="http://gonggongjohn.me/2021/12/25/database/db-assignment-2/redis_concur_test2.png">
<meta property="article:published_time" content="2021-12-25T02:00:00.000Z">
<meta property="article:modified_time" content="2022-12-07T06:49:21.563Z">
<meta property="article:author" content="GONGGONGJOHN">
<meta property="article:tag" content="Computer-Science">
<meta property="article:tag" content="Database">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://gonggongjohn.me/2021/12/25/database/db-assignment-2/system_arch.png">
  
  
  <title>当代数据管理系统项目二：书店（Bookstore） - GONGGONGJOHN&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"gonggongjohn.me","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="GONGGONGJOHN's Blog" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>GONGGONGJOHN&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="当代数据管理系统项目二：书店（Bookstore）">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-12-25 10:00" pubdate>
        2021年12月25日 上午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      6.1k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      51 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">当代数据管理系统项目二：书店（Bookstore）</h1>
            
            <div class="markdown-body">
              <h2 id="实验要求">实验要求</h2>
<h3 id="功能">功能</h3>
<p>实现一个提供网上购书功能的网站后端。网站支持书商在上面开商店，购买者可能通过网站购买。买家和卖家都可以注册自己的账号。一个卖家可以开一个或多个网上商店，买家可以为自已 的账户充值，在任意商店购买图书。支持下单 <span class="math inline">\(\to\)</span> 付款 <span class="math inline">\(\to\)</span> 发货 <span class="math inline">\(\to\)</span> 收货的流程。</p>
<ol type="1">
<li><p>实现对应接口的功能，见 doc 下面的.md 文件描述（60% 分数）</p>
<ol type="a">
<li><p>用户权限接口，如注册、登录、登出、注销</p></li>
<li><p>买家用户接口，如充值、下单、付款</p></li>
<li><p>卖家用户接口，如创建店铺、填加书籍信息及描述、增加库存 通过对应的功能测试，所有 test case 都 pass。测试下单及付款两个接口的性能（最好分离负载生成和后端），测出支持的每分钟交易数，延迟等</p></li>
</ol></li>
<li><p>为项目添加其它功能：(40% 分数)</p>
<ol type="a">
<li><p>实现后续的流程 发货 → 收货</p></li>
<li><p>搜索图书 用户可以通过关键字搜索，参数化的搜索方式;如搜索范围包括，题目，标签，目录，内容;全站搜索或是当前店铺搜索。如果显示结果较大，需要分页(使用全文索引优化查找)</p></li>
<li><p>订单状态，订单查询和取消定单。 用户可以查自已的历史订单，用户也可以取消订单。</p></li>
</ol>
<p>取消定单(可选项，加分 +5 ∼ 10)，买家主动地取消定单，如果买家下单经过一段时 间超时后，如果买家未付款，定单也会自动取消。</p></li>
</ol>
<h3 id="要求">要求</h3>
<ol type="1">
<li>允许向接口中增加或修改参数，允许修改 HTTP 方法，允许增加新的测试接口，请尽量不 要修改现有接口的 url 或删除现有接口，请根据设计合理的拓展接口(加分项 +2 ∼ 5 分)。 测试程序如果有问题可以提 bug(加分项，每提 1 个 BUG +2, 提 1 个 Pull Request +5)。</li>
<li>核心数据使用关系型数据库(PostgreSQL 或 MySQL 数据库)。blob 数据(如图片和大段 的文字描述)可以分离出来存其它 NoSQL 数据库或文件系统。</li>
<li>对所有的接口都要写 test case，通过测试并计算代码覆盖率(有较高的覆盖率是加分项 +2 ∼ 5)。</li>
<li>尽量使用正确的软件工程方法及工具，如:版本控制，测试驱动开发(利用版本控制是加 分项 +2 ∼ 5)。</li>
<li>后端使用技术，实现语言不限;不要复制这个项目上的后端代码(不是正确的实践，减分 项 − 2 ∼ 5 )。</li>
<li>不需要实现页面。</li>
<li>最后评估分数时考虑以下要素:</li>
</ol>
<ol type="a">
<li>实现完整度，全部测试通过，效率合理</li>
<li>正确地使用数据库和设计分析工具，ER 图，从 ER 图导出关系模式，规范化，事务处理，索引等 (c) 其它 · · ·</li>
</ol>
<ol start="8" type="1">
<li>3个人一组，做好分工，量化每个人的贡献度</li>
</ol>
<h2 id="项目实现">项目实现</h2>
<h3 id="系统构架">系统构架</h3>
<p>作为一个经典的电商平台项目，我们采用了前后端分离和微服务的构架对整个系统进行了设计。整个系统的构架如下图所示（Figure 1）。其中，Nginx 支撑起一个前端维生容器，并向用户提供一个的由 Vue.js 搭建的前端服务(正向代理)。根据网页中的 UI 元素，用户可以根据通过配置好的请求方式向后端的对应接口发送 Http 请求(Axios)。请求会首先经过网关，并发送 到一个同样由 Nginx 维护的负载均衡服务器上(反向代理)。该服务器维护了当前系统内所有可 用的服务节点，并根据系统负载将所有的请求均摊到对应的服务上。在服务运行的过程中一共 涉及到 4 个数据库:PostgreSQL 主数据库、MongoDB 扩展数据库、Redis 缓存数据库和 ElasticSearch 搜索服务数据库，这些数据库通过分离部署的方式被所有服务容器所共享。此 外，一个由 Zookeeper 维护着的分布式 Kafka 消息队列连接着所有的组件，为所有微服务和数 据库间提供消息同步的机制。</p>
<img src="/2021/12/25/database/db-assignment-2/system_arch.png" srcset="/img/loading.gif" lazyload class="" title="system_arch">
<h3 id="数据库设计">数据库设计</h3>
<h4 id="entity-relation图">Entity-Relation图</h4>
<p>本项目的 Entity-Relation 图如下(Figure 2)。书店主要包含用户、商店、商品、订单和购 物车五个实体。其中用户和商店构成经营的关系，用户和购物车构成操作的关系，用户与订单依 据买家和卖家的角色构成下单和处理的关系;商品和商店构成出售的关系，商品和购物车构成包 含的关系，商品和订单构成组成的关系。</p>
<h4 id="关系数据库">关系数据库</h4>
<h4 id="键值对数据库">键值对数据库</h4>
<h4 id="冗余">冗余</h4>
<h4 id="事务处理">事务处理</h4>
<h4 id="数据库选型">数据库选型</h4>
<p>本实验要求我们使用关系型数据库作为系统的核心数据库。现阶段，市面上两大主流的传 统关系型数据库即为 MySQL 和 PostgreSQL(SQL Server 主要服务于 Windows 及其衍生系 统，而本项目设计的目标系统为 Linux 相关系统，故不作考虑)。下面我们来对这两大关系型数 据库进行分析，以确定在该项目中所要选用的核心数据库。</p>
<p>作为 Oracle 旗下的老牌关系型数据库，MySQL 已经在无数的应用上发挥出了其威力。然而， 作为一个以商用为主的软件，MySQL 分为免费的 Community(社区版)和收费的 Enterprise (商业版)，这就导致了其社区版本在许多功能上都受到了限制。此外，尽管 MySQL 的社区版本 开放了源代码，但其使用的 GPL 协议使得二次开发受到了许多的限制。相比之下，PostgreSQL 是一款完全由社区(PostgreSQL Global Development Group)维护的开源关系型数据库，这就 意味着其开发和改进相比 MySQL 更为方便和敏捷。其使用的类 BSD/MIT 协议也使得二次开发变得容易。</p>
<p>PostgreSQL 的宣传标语就是“世界上最先进的开源关系型数据库”，这也意味着其拥有着更新的特性。从功能上来说，PostgreSQL 相比 MySQL 增加了大量的数据类型，如 Array 和 JSON，且在部分原始数据类型上相比 MySQL 也有更小的限制(如 TEXT 类型)。这一特性使 得 PostgreSQL 甚至可以作为 NoSQL 来使用。此外，从运维上来说，PostgreSQL 拥有许多实用 的特性，如:DDL 操作能够放入事务中、能够并发地创建或删除索引、多样化的复制和提交方 式等。这些特性能够帮助我们快速完成对数据库中结构的修改，这对于类似本实验这样的小型项 目是十分重要的。</p>
<p>从 DB Engines 网站上我们可以看到近几年几大关系型数据库的流行程度(Figure 11)。可以 发现，尽管 MySQL 仍然占据着主导的数据库比例，但其市场占比已经开始有下降的趋势;而 PostgreSQL 作为一款新兴的关系型数据库，其市场占有率自 2014 年起就始终以一个极高的速 度增长着，这也充分表明了 PostgreSQL 在实际使用场景下的优势。</p>
<img src="/2021/12/25/database/db-assignment-2/db_ranking.png" srcset="/img/loading.gif" lazyload class="" title="db_ranking">
<p>MySQL 使用了 InnoDB 作为其主要存储引擎(新版本下的 MySQL 支持如 MyISAM 等其 他存储，但由于其不支持完整的事务处理功能，故不常被使用)，尽管自起发明以来已经取得了 长足的进步，但仍然有不少案例报告系统在运行过程中出现了服务器级别的数据库丢失现象。相 比较之下，在实际使用过程中，PostgreSQL 的稳定性更强。从性能上来说，MySQL 使用多线 程技术来提升系统性能的利用率，而 PostgreSQL 使用了多进程技术。在现代处理器上，后者相 比前者有着更好的优化空间。在实际的使用过程中，PostgreSQL 在面对高并发访问请求时相比 MySQL 也的确拥有着更好的表现。除此之外，当数据库负载逼近极限下，PostgreSQL 的性能指 标仍可以维持双曲线甚至对数曲线，到顶峰之后不再下降，而 MySQL 会明显出现一个波峰后下滑。</p>
<p>为了实际测试 MySQL 和 PostgreSQL 的性能表现，我们使用 Sysbench 基准测试工具分别 对同一台部署了 MySQL 和 PostgreSQL 的服务器进行了性能测试，如下图所示(Figure 12)。 测试结果表明，同等配置下，PostgreSQL 的综合性能表现达到了 MySQL 的近两倍。</p>
<img src="/2021/12/25/database/db-assignment-2/mysql_postgresql_compare.png" srcset="/img/loading.gif" lazyload class="" title="mysql_postgresql_compare">
<p>综合上面的结果，在本项目中，我们使用了 PostgreSQL 作为系统的核心数据库。</p>
<p>除此之外，在书店系统中，一本书本商品通常还会带有大量的 BLOB 数据，如图书简介、作 者简介、图书照片等。若直接这些数据放在关系型数据库中，会导致一个字段过长，且不方便存 储和扩展。对于这些数据，文档型数据库(Document Database)是一种极好的存储方式。在 本应用中，我们使用 MongoDB 来作为系统的扩展数据存储数据库。</p>
<h4 id="数据库调优">数据库调优</h4>
<p>除了前文中所讨论的如索引、冗余、事务处理等数据访问优化，对于数据库本身而言，其当前配 置也是一个需要考虑的问题。通常来说，一个数据库的默认配置是较为保守的，在很多场景下无 法完全利用系统中的资源。为了提升设备利用效率，我们需要对数据库的相关配置进行调优。由 于 MongoDB 等 NoSQL 本身已经具有了极强的性能分配机制，因此我们主要针对传统关系型数 据库进行调优。</p>
<p>对于 PostgreSQL 数据库，我们使用如下配置对参数进行了优化(Table 1)</p>
<h3 id="接口设计">接口设计</h3>
<p>本实验共设计并实现了 33 个接口，其中包括 11 个基础接口以及 22 个额外接口。额外接口 一部分用于给前端提供必要的展示数据，对数量较大的数据进行了分页处理，另一部分则用于用 户信息修改、购物车、订单的后续处理 (发货、收货、评价及取消)、商品搜索和商品评论等功能。</p>
<h3 id="前端实现">前端实现</h3>
<h3 id="后端实现">后端实现</h3>
<h4 id="springboot服务构架">Springboot服务构架</h4>
<p>为了实现一个完整的电商服务平台并能够应对各种可能的情况，我们必须使用一个足够方便 且功能全面的后端开发框架。作为当前世界上最流行的后端服务框架，Spring 拥有着后端开发 中最全的生态系统。为了方便开发，在本项目中，我们使用了 Springboot 作为后端开发框架。</p>
<p>书店系统的后端构架如下图所示(Figure 30)。整个系统共分为 5 层，拦截层(Interceptor) 负责验证请求的 Token 信息是否合法，控制层(Controller)负责接口的声明和参数传递，服 务层(Service)负责各种服务的实现，持久化层(DAO，Data Access Operator)负责与数 据库的 CRUD 及其他各种操作，模型层(Model)用于声明各种应用中存在的数据实体。</p>
<img src="/2021/12/25/database/db-assignment-2/backend_layer.png" srcset="/img/loading.gif" lazyload class="" title="backend_layer">
<p>为了方便开发和统一接口，我们使用了 ORM(Object Relational Mapping)和 ODM (Object Document Mapping)的方式将 Java 对象和数据库中的实体建立联系。这一功能是 由 Spring 生态中强大的驱动器(Driver)组件所保证的。具体来说，本项目用到的全部模块依赖如下表所示(Table 2)。</p>
<p>在实际处理请求的过程中，各功能层会被逐层调用，以做到业务的隔离。以买家服务控制器 (BuyerController)为例，其加载流程如下图所示(Figure 31)。可以看到，控制器层首先调用 各服务接口层(Service Interface)，并由服务实现层(Service Implementation)完成所有的请求处理逻辑。对于其中的数据库操作，服务层再接着调用持久化层和模型层完成相应的操作。</p>
<img src="/2021/12/25/database/db-assignment-2/buyer_controller_uml.png" srcset="/img/loading.gif" lazyload class="" title="buyer_controller_uml">
<h3 id="高可用">高可用</h3>
<p>高可用性(High Availability)是指系统无中断地执行其功能的能力超过其同级别的系统， 代表系统的可用性程度，是进行系统设计时的准则之一 [Wik21a]。</p>
<p>造成服务不可用的原因有很多，其中一个十分重要的原因便是过多的并发请求(Concurrent Request)。在 WEB 服务中，并发请求是指一个或多个用户在同一时刻或相隔极短的时刻内发 送至目标服务器，并使得服务器需要同时处理并响应的请求。随着互联网规模的高速发展，这一 现象在一些热门服务供应商中体现的越来越明显。近年来，因为短时间内收到大量请求使得服务 器崩溃导致无法提供正常服务的事故屡次发生(Figure 37, 38)，这些事故严重影响了用户的体 验和服务的质量，也使得学术界和工业界加强了对高可用系统设计的重视。</p>
<p>一个高可用系统的设计通常具有以下三条原则：</p>
<ul>
<li>消除单点故障(Elimination of single points of failure)</li>
<li>可靠的交叉点服务(Reliable crossover)</li>
<li>提前检测故障并快速恢复(Detection of failures as they occur)</li>
</ul>
<p>在本实验中，我们需要测出书店系统中下单和付款接口的吞吐量，这正是一个极好的高并发 场景的实例。根据上述的三条原则，我们实现了一系列策略来提升这两个接口的吞吐量，并使得 整个书店系统在各种情况下都能够保持较高的可用性。</p>
<h4 id="redis与缓存数据库">Redis与缓存数据库</h4>
<p>由于需要管理的数据量通常十分庞大(GB 甚至 TB 级)，且需要支持完整的事务处理能力，常 规的关系性数据库通常使用磁盘来对数据进行维护，并使用页(Page)为单位对数据进行存取。 因此，对数据库中的内容进行一次访问通常具有很高的 I/O 代价。通过实际的测试我们也发现， 在整个服务的响应逻辑中，对数据库的访问代价占据了整个请求处理过程中绝大部分的耗时。在 高并发场景下，这一时间开销使得数据库系统很快就会遇到性能瓶颈，并使得后续的请求难以得 到正确的响应。</p>
<p>Redis(Remote Dictionary Server，远程字典服务) 是一款开源的、基于内存存储的分布 式 Key-Value 型数据库 [Wik21b]。作为 NoSQL 的一种，Redis 设计的宗旨就是为了在面对大量 随机读写请求时能够以尽可能高的效率存取数据，因此其天然地拥有极高的并发处理能力。经验 值表明，在一台常规的小型笔记本上，Redis 能够支持约 110000 次/秒的写操作和 81000 次/秒 的读操作 [Jai19]，这一数值几乎是传统关系型数据库吞吐量的近 100 倍。因此，使用 Redis 作 为主数据库的缓存数据库来提升整个服务的响应能力是一个十分合适的选择。</p>
<p>我们使用 JMeter 接口压测工具，分别向直接访问 Postgresql 数据库和使用了 Redis 缓存的 两个测试接口发送了 10000 次并发请求，其响应结果如下图所示(Figure 39, 40)。可以看到，使 用了 Redis 缓存的接口吞吐量几乎是直接访问 Postgresql 数据库接口的两倍，前者的平均响应 时间更是比后者快了整整 5 倍。</p>
<img src="/2021/12/25/database/db-assignment-2/db_concur_test2.png" srcset="/img/loading.gif" lazyload class="" title="db_concur_test2">
<img src="/2021/12/25/database/db-assignment-2/redis_concur_test2.png" srcset="/img/loading.gif" lazyload class="" title="redis_concur_test2">
<p>要使用 Redis 作为缓存，我们就需要分析在当前业务中哪些数据是经常被访问的数据，即所 谓的热点数据。在当前应用中，热点数据的访问主要发生在下单和付款两个接口请求的处理上。 对于下单操作，系统需要读取商品的库存、价格;对于付款操作，系统需要读取用户的密码、账 户余额及订单的总价。</p>
<p>书店系统的 Redis 缓存结构如下表所示(Table 4)。其中，user 键和 store 键分别维护当前系 统中所有的用户 ID 和商店 ID，用于快速判断下单和付款请求是否合法;stock_{图书 ID}<em>{商店 ID} 和 price</em>{图书 ID}<em>{商店 ID} 键分别用于维护热点商品的库存和价格信息(分开存储 是为了支持 Redis 的原子级自增(Increment)和自减(Decrement)操作);user</em>{用户名} 键用于存放已登录用户当前的密码及账户余额，用于在付款请求中快速确认用户身份并判断用 户账户是否有足够的足额支付当前订单;order_{订单号} 键用于临时存放下单成功的订单总价(若订单创建后的 T 时刻内仍没有被付款接口更新，则该 Redis 键自动过期，也即订单自动取 消)。</p>
<h4 id="布隆过滤器与缓存防穿透">布隆过滤器与缓存防穿透</h4>
<h4 id="caffeine与多级缓存">Caffeine与多级缓存</h4>
<h4 id="kafka与消息队列">Kafka与消息队列</h4>
<h4 id="nginx与负载均衡">Nginx与负载均衡</h4>
<h2 id="项目部署">项目部署</h2>
<h2 id="项目测试">项目测试</h2>
<h3 id="接口测试">接口测试</h3>
<h4 id="单元测试规范">单元测试规范</h4>
<h4 id="junit5">JUnit5</h4>
<h4 id="基础接口测试代码移植">基础接口测试代码移植</h4>
<h4 id="基础接口测试">基础接口测试</h4>
<h4 id="额外接口测试">额外接口测试</h4>
<h3 id="代码覆盖率">代码覆盖率</h3>
<h3 id="吞吐量测试">吞吐量测试</h3>
<h2 id="开发说明">开发说明</h2>
<h3 id="版本控制">版本控制</h3>
<h3 id="项目分工">项目分工</h3>
<h2 id="后记">后记</h2>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Computer-Science/">Computer-Science</a>
                    
                      <a class="hover-with-bg" href="/tags/Database/">Database</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/03/16/contemporary-ai/contemporary-ai-exp-1/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">当代人工智能 课程项目一 文本分类</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/12/24/machine-learning/dase-alg-exp-summary/">
                        <span class="hidden-mobile">数据科学与工程算法基础 文本摘要实验</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
